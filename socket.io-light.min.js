(function(g){function k(a){var c="";if("object"!==typeof a||!a.type||!a.data||"object"!==typeof a.data)return c;c+=a.type;c+=JSON.stringify(a.data);return"4"+c}function l(a){var c={},b=0;if("string"!==typeof a)return c;for(;"["!==a[b]&&b<a.length;)b++;try{c=JSON.parse(a.substring(b))}catch(d){console.log(d)}return c}if("undefined"===typeof g.WebSocket)throw"The browser does not seem to support web sockets";if("undefined"!==typeof g.io)throw"window.io already defined";g.io=function(a,b){return g.io.connect(a,
b)};var b=g.io;b.socket=null;b.eventListeners=[];b.on=function(a,c){b.eventListeners.push({evtName:a,callback:c})};b.eventReceiver=function(a){for(var c=0;c<b.eventListeners.length;c++)a&&"undefined"!==typeof a.shift&&b.eventListeners[c].evtName===a[0]&&b.eventListeners[c].callback(a[1])};b.eventDispatcher=function(a){b.eventReceiver(l(a.data))};b.emit=function(a,c){var f={type:2,data:[a,c]};b.socket.readyState===b.socket.OPEN&&b.socket.send(k(f))};b.connect=function(a,c){a="string"===typeof a?a:
location.protocol+"//"+location.host+"/socket.io";var f=document.createElement("a");f.href=a;var d=new XMLHttpRequest;d.open("GET",f.protocol+"//"+f.host+f.pathname+"/?EIO=3&transport=polling&t="+(new Date).getTime()+"-0",!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){for(var a=new Uint8Array(d.response),h="",e={},e=0;"{"!==String.fromCharCode(a[e])&&e<a.length;)e++;for(;e<a.length;)h+=String.fromCharCode(a[e]),e++;e=JSON.parse(h);g.chat.sid=
e.sid;b.socket=new WebSocket("ws://"+f.host+f.pathname+"/?EIO=3&transport=websocket&sid="+g.chat.sid);b.socket.onopen=function(){b.socket.send("5");b.socket.onmessage=b.eventDispatcher;"function"===typeof c&&setTimeout(c,0)}}};d.send();return b}})(window);
